
context ()


library (abseil)

n <- 200
P <- 20

X <- cbind(1, matrix(rnorm(n * (P-1)), n))
b <- rnorm(P, sd = sqrt(5))
sigma.sq <- 1
y <- rnorm(n, X %*% b, sqrt(sigma.sq))


## loglik <- function(theta, y, X, sigma.sq) {
loglik <- function(theta) {
  resid <- c(y - X %*% theta)
  0.5 / sigma.sq * c(crossprod(resid))
}

## loglik.grad <- function(theta, y, X, sigma.sq) {
loglik.grad <- function(theta) {
  -c(1 / sigma.sq * t(X) %*% c(y - X %*% theta))
}


x0 <- rnorm(P)
cbind(Analytical = loglik.grad(x0), numDeriv = numDeriv::grad(loglik, x0))


opt <- gr.descent(rnorm(P), loglik, .learning.rate = 0.1,
                  .tol = 1e-6, .velocity.decay = 0.999)


opt <- gr.descent(rnorm(P), loglik, loglik.grad, .learning.rate = 0.5,
                  .tol = 1e-5, .velocity.decay = 0.999)

fit0 <- lm(y ~ X - 1)

cbind(lm = coef(lm(y ~ X - 1)), AdaM = opt$par)
